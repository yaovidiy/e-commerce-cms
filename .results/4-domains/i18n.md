# Internationalization (i18n) Domain Implementation

## Overview
The i18n system uses @inlang/paraglide-sveltekit for compile-time internationalization with zero runtime overhead. Translations are compiled during build, not loaded dynamically.

## Core Configuration

### i18n Instance (`src/lib/i18n.ts`)
```typescript
import * as runtime from '$lib/paraglide/runtime';
import { createI18n } from '@inlang/paraglide-sveltekit';

export const i18n = createI18n(runtime);
```

### Routing Setup (`src/hooks.ts`)
```typescript
import { i18n } from '$lib/i18n';

export const reroute = i18n.reroute();
```

**This enables:**
- `/en/page` - English
- `/uk/page` - Ukrainian  
- `/page` - Default locale

### App Wrapper (`src/routes/+layout.svelte`)
```svelte
<script lang="ts">
	import { i18n } from '$lib/i18n';
	import { ParaglideJS } from '@inlang/paraglide-sveltekit';
	import '../app.css';
	
	let { children } = $props();
</script>

<ParaglideJS {i18n}>
	{@render children()}
</ParaglideJS>
```

**Must wrap entire app** with `<ParaglideJS>` component

### Hooks Sequence (`src/hooks.server.ts`)
```typescript
import { sequence } from '@sveltejs/kit/hooks';
import { i18n } from '$lib/i18n';

const handleParaglide: Handle = i18n.handle();
const handleAuth: Handle = async ({ event, resolve }) => {
  // Auth logic...
};

// i18n handle MUST come before auth
export const handle: Handle = sequence(handleParaglide, handleAuth);
```

## Project Structure

### Configuration Directory
```
project.inlang/
├── project_id          # Project identifier
├── settings.json       # i18n settings
└── cache/             # Build cache
```

### Message Files
```
messages/
├── en.json            # English translations
└── uk.json            # Ukrainian translations
```

### Generated Code
```
src/lib/paraglide/
├── messages.js        # Compiled message functions
├── runtime.js         # Runtime helpers
└── messages/
    ├── en.js         # English messages
    └── uk.js         # Ukrainian messages
```

**Never edit generated files manually** - they're auto-generated on build

## Message File Format

### JSON Structure (`messages/en.json`)
```json
{
  "welcome": "Welcome",
  "greeting": "Hello, {name}!",
  "itemCount": "You have {count} item(s)",
  "login": {
    "title": "Sign In",
    "button": "Login",
    "error": "Invalid credentials"
  }
}
```

### With Parameters
Messages can include parameters in curly braces:
```json
{
  "userGreeting": "Welcome back, {username}!",
  "pluralExample": "{count, plural, =0 {No items} =1 {One item} other {{count} items}}"
}
```

## Using Translations

### In Svelte Components
```svelte
<script>
  import * as m from '$lib/paraglide/messages';
</script>

<h1>{m.welcome()}</h1>
<p>{m.greeting({ name: 'John' })}</p>
<button>{m.login.button()}</button>
```

### In TypeScript Files
```typescript
import * as m from '$lib/paraglide/messages';

const title = m.welcome();
const greeting = m.greeting({ name: 'Jane' });
```

### In Server Code
```typescript
// Server-side translations also work
import * as m from '$lib/paraglide/messages';

export const load: PageServerLoad = async ({ locals }) => {
  return {
    title: m.pageTitle()
  };
};
```

## Language Switching

### Get Current Language
```typescript
import { languageTag } from '$lib/paraglide/runtime';

const currentLang = languageTag(); // 'en' or 'uk'
```

### Language Links
```svelte
<script>
  import { i18n } from '$lib/i18n';
  import { page } from '$app/stores';
  
  const currentPath = $page.url.pathname;
</script>

<nav>
  <a href={i18n.route(currentPath, { lang: 'en' })}>English</a>
  <a href={i18n.route(currentPath, { lang: 'uk' })}>Українська</a>
</nav>
```

### Programmatic Navigation
```typescript
import { goto } from '$app/navigation';
import { i18n } from '$lib/i18n';

async function switchLanguage(lang: string) {
  await goto(i18n.route($page.url.pathname, { lang }));
}
```

## Vite Plugin Configuration

### Vite Config (`vite.config.ts`)
```typescript
import { paraglide } from '@inlang/paraglide-sveltekit/vite';

export default defineConfig({
  plugins: [
    // ... other plugins
    paraglide({
      project: './project.inlang',
      outdir: './src/lib/paraglide'
    })
  ]
});
```

**Parameters:**
- `project`: Path to inlang project directory
- `outdir`: Where to output generated code

## Supported Locales

Current configuration supports:
- `en` - English
- `uk` - Ukrainian

## Compile-Time Benefits

### Zero Runtime
- No translation loading at runtime
- No i18n library in browser bundle
- Translations compiled to function calls

### Type Safety
```typescript
// TypeScript knows about all messages
m.welcome();           // ✓ Valid
m.greeting({ name }); // ✓ Valid, requires name param
m.invalid();          // ✗ TypeScript error
m.greeting();         // ✗ TypeScript error (missing param)
```

### Tree Shaking
- Only used translations included in bundle
- Unused translations automatically removed

## URL Structure

### With Locale Prefix
```
/en/about        - English about page
/uk/about        - Ukrainian about page
/en/blog/slug    - English blog post
/uk/blog/slug    - Ukrainian blog post
```

### Default Locale
```
/about          - Uses default locale (likely English)
```

### Language Detection
- URL locale prefix takes precedence
- Falls back to default if no prefix
- No browser language detection (explicit only)

## Best Practices

1. **Organize by feature**: Group related messages
   ```json
   {
     "auth": {
       "login": "Login",
       "logout": "Logout"
     },
     "blog": {
       "title": "Blog",
       "create": "New Post"
     }
   }
   ```

2. **Use parameters**: For dynamic content
   ```json
   {
     "itemCount": "{count} items found"
   }
   ```

3. **Keep keys semantic**: Use descriptive keys
   ```json
   { "submit_button": "Submit" }  // ✗ Bad
   { "form.submit": "Submit" }    // ✓ Good
   ```

4. **Don't concatenate**: Use full sentences
   ```json
   // ✗ Bad
   { "welcome": "Welcome", "name": "{name}" }
   
   // ✓ Good
   { "welcomeUser": "Welcome, {name}!" }
   ```

5. **Provide context**: Comment complex messages
   ```json
   {
     // Used on checkout page when cart is empty
     "emptyCart": "Your cart is empty"
   }
   ```

6. **Test all locales**: Ensure translations exist for all keys

7. **Version control**: Commit message files and settings

8. **Never edit generated**: Don't touch `src/lib/paraglide/*`

9. **Consistent naming**: Use same case/format across locales

10. **Handle missing**: Provide fallback for missing translations

## Common Patterns

### Navigation Menu
```svelte
<nav>
  <a href={i18n.route('/')}>{m.nav.home()}</a>
  <a href={i18n.route('/about')}>{m.nav.about()}</a>
  <a href={i18n.route('/blog')}>{m.nav.blog()}</a>
</nav>
```

### Form Labels
```svelte
<form>
  <label>
    {m.form.username()}
    <input name="username" />
  </label>
  <label>
    {m.form.password()}
    <input type="password" name="password" />
  </label>
  <button>{m.form.submit()}</button>
</form>
```

### Error Messages
```svelte
<script>
  import * as m from '$lib/paraglide/messages';
  
  let error = $state(null);
</script>

{#if error}
  <p class="error">
    {m.errors[error.code]?.() ?? m.errors.generic()}
  </p>
{/if}
```

### Date Formatting
```svelte
<script>
  import { languageTag } from '$lib/paraglide/runtime';
  
  const date = new Date();
  const formatted = date.toLocaleDateString(languageTag());
</script>

<time datetime={date.toISOString()}>{formatted}</time>
```

## Limitations

1. **No dynamic loading**: All translations at compile time
2. **No runtime switching**: Requires page reload/navigation
3. **Build required**: Changes require rebuild
4. **Static only**: Can't load translations from API
5. **File-based**: Messages must be in JSON files

## Migration from Runtime i18n

If migrating from runtime i18n libraries:
1. Convert dynamic keys to compile-time keys
2. Remove runtime translation loading
3. Update imports to use generated functions
4. Replace `t('key')` with `m.key()`
5. Add `<ParaglideJS>` wrapper
6. Setup `reroute()` in hooks

## Dependencies

- `@inlang/paraglide-sveltekit`: Main library
- Generated runtime in `$lib/paraglide/`
- No additional runtime dependencies
